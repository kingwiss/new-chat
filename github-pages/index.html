<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cerebray - GitHub Pages</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%233498db'/%3E%3Ccircle cx='35' cy='40' r='8' fill='white'/%3E%3Ccircle cx='65' cy='40' r='8' fill='white'/%3E%3Cpath d='M30 65 Q50 80 70 65' stroke='white' stroke-width='4' fill='none'/%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo svg {
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        h1 {
            color: white;
            font-size: 2.5rem;
            font-weight: 300;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .status {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .video-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .video-wrapper {
            position: relative;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            aspect-ratio: 4/3;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-label {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .waiting-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-align: center;
            font-size: 1.1rem;
            display: none;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .connection-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .connection-method {
            margin-bottom: 20px;
        }

        .connection-method h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .connection-code {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }

        .connection-code input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .connection-code button {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .chat-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 20px;
            height: 300px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 15px;
            max-width: 80%;
        }

        .message.own {
            background: #3498db;
            color: white;
            margin-left: auto;
            text-align: right;
        }

        .message.other {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 20px;
            font-size: 1rem;
        }

        .chat-input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }

        .send-btn {
            padding: 10px 20px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }

        .send-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .info-box {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid #3498db;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-box h3 {
            color: #2980b9;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #34495e;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .video-container {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="48" height="48">
                        <circle cx="50" cy="50" r="45" fill="#3498db"/>
                        <circle cx="35" cy="40" r="8" fill="white"/>
                        <circle cx="65" cy="40" r="8" fill="white"/>
                        <path d="M30 65 Q50 80 70 65" stroke="white" stroke-width="4" fill="none"/>
                    </svg>
                </div>
                <h1>Cerebray</h1>
            </div>
        </header>
        
        <div class="info-box">
            <h3>ðŸŒŸ GitHub Pages Demo Version</h3>
            <p>This is a simplified peer-to-peer version that works on GitHub Pages. To connect with someone, both users need to share connection codes manually. For the full experience with automatic matching, deploy the Node.js version to platforms like Heroku or Railway.</p>
        </div>
        
        <div class="status">
            <div id="statusMessage">Click "Start Camera" to begin</div>
        </div>
        
        <div class="main-content">
            <div class="video-container">
                <div class="video-wrapper">
                    <video id="localVideo" autoplay muted playsinline></video>
                    <div class="video-label">You</div>
                </div>
                <div class="video-wrapper">
                    <video id="remoteVideo" autoplay playsinline></video>
                    <div class="video-label">Partner</div>
                    <div id="waitingMessage" class="waiting-message">Waiting for connection...</div>
                </div>
            </div>
            
            <div class="controls">
                <button id="startBtn" class="btn btn-primary">Start Camera</button>
                <button id="createOfferBtn" class="btn btn-secondary" disabled>Create Offer</button>
                <button id="endBtn" class="btn btn-danger" disabled>End Chat</button>
            </div>
            
            <div class="connection-section">
                <div class="connection-method">
                    <h3>ðŸ“¤ Share Your Offer (Step 1)</h3>
                    <div class="connection-code">
                        <input type="text" id="localOffer" placeholder="Your offer will appear here..." readonly>
                        <button onclick="copyToClipboard('localOffer')">Copy</button>
                    </div>
                </div>
                
                <div class="connection-method">
                    <h3>ðŸ“¥ Paste Partner's Offer (Step 2)</h3>
                    <div class="connection-code">
                        <input type="text" id="remoteOffer" placeholder="Paste partner's offer here...">
                        <button id="acceptOfferBtn" onclick="acceptOffer()">Accept</button>
                    </div>
                </div>
                
                <div class="connection-method">
                    <h3>ðŸ“¤ Share Your Answer (Step 3)</h3>
                    <div class="connection-code">
                        <input type="text" id="localAnswer" placeholder="Your answer will appear here..." readonly>
                        <button onclick="copyToClipboard('localAnswer')">Copy</button>
                    </div>
                </div>
                
                <div class="connection-method">
                    <h3>ðŸ“¥ Paste Partner's Answer (Step 4)</h3>
                    <div class="connection-code">
                        <input type="text" id="remoteAnswer" placeholder="Paste partner's answer here...">
                        <button onclick="acceptAnswer()">Connect</button>
                    </div>
                </div>
            </div>
            
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div style="text-align: center; color: #7f8c8d; font-style: italic;">Connect to start chatting!</div>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Connect to start chatting..." disabled>
                    <button class="send-btn" id="sendBtn" disabled>Send</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class GitHubPagesVideoChat {
            constructor() {
                this.localStream = null;
                this.remoteStream = null;
                this.peerConnection = null;
                this.dataChannel = null;
                this.isConnected = false;
                
                this.localVideo = document.getElementById('localVideo');
                this.remoteVideo = document.getElementById('remoteVideo');
                this.startBtn = document.getElementById('startBtn');
                this.createOfferBtn = document.getElementById('createOfferBtn');
                this.endBtn = document.getElementById('endBtn');
                this.statusMessage = document.getElementById('statusMessage');
                this.waitingMessage = document.getElementById('waitingMessage');
                this.chatMessages = document.getElementById('chatMessages');
                this.chatInput = document.getElementById('chatInput');
                this.sendBtn = document.getElementById('sendBtn');
                
                this.initializeEventListeners();
            }
            
            initializeEventListeners() {
                this.startBtn.addEventListener('click', () => this.startCamera());
                this.createOfferBtn.addEventListener('click', () => this.createOffer());
                this.endBtn.addEventListener('click', () => this.endChat());
                
                this.sendBtn.addEventListener('click', () => this.sendMessage());
                this.chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
            }
            
            async startCamera() {
                try {
                    this.statusMessage.textContent = 'Accessing camera...';
                    
                    this.localStream = await navigator.mediaDevices.getUserMedia({
                        video: true,
                        audio: true
                    });
                    
                    this.localVideo.srcObject = this.localStream;
                    
                    this.startBtn.disabled = true;
                    this.createOfferBtn.disabled = false;
                    this.endBtn.disabled = false;
                    
                    this.statusMessage.textContent = 'Camera ready! Create an offer to connect.';
                    
                } catch (error) {
                    console.error('Error accessing media devices:', error);
                    this.statusMessage.textContent = 'Error accessing camera. Please allow camera access and try again.';
                }
            }
            
            async createOffer() {
                await this.createPeerConnection();
                
                const offer = await this.peerConnection.createOffer();
                await this.peerConnection.setLocalDescription(offer);
                
                document.getElementById('localOffer').value = JSON.stringify(offer);
                this.statusMessage.textContent = 'Offer created! Share it with your partner.';
            }
            
            async createPeerConnection() {
                const configuration = {
                    iceServers: [
                        { urls: 'stun:stun.l.google.com:19302' },
                        { urls: 'stun:stun1.l.google.com:19302' }
                    ]
                };
                
                this.peerConnection = new RTCPeerConnection(configuration);
                
                // Add local stream
                this.localStream.getTracks().forEach(track => {
                    this.peerConnection.addTrack(track, this.localStream);
                });
                
                // Create data channel for chat
                this.dataChannel = this.peerConnection.createDataChannel('chat');
                this.setupDataChannel(this.dataChannel);
                
                // Handle incoming data channel
                this.peerConnection.ondatachannel = (event) => {
                    this.setupDataChannel(event.channel);
                };
                
                // Handle remote stream
                this.peerConnection.ontrack = (event) => {
                    console.log('Received remote stream');
                    this.remoteVideo.srcObject = event.streams[0];
                    this.isConnected = true;
                    this.statusMessage.textContent = 'Connected! Enjoy your chat.';
                    this.hideWaiting();
                    this.enableChat();
                };
                
                // Handle ICE candidates
                this.peerConnection.onicecandidate = (event) => {
                    if (event.candidate) {
                        console.log('ICE candidate generated');
                    }
                };
                
                // Handle connection state changes
                this.peerConnection.onconnectionstatechange = () => {
                    console.log('Connection state:', this.peerConnection.connectionState);
                    if (this.peerConnection.connectionState === 'disconnected' || 
                        this.peerConnection.connectionState === 'failed') {
                        this.handleDisconnection();
                    }
                };
            }
            
            setupDataChannel(channel) {
                channel.onopen = () => {
                    console.log('Data channel opened');
                    this.enableChat();
                };
                
                channel.onmessage = (event) => {
                    this.displayMessage(event.data, false);
                };
                
                channel.onclose = () => {
                    console.log('Data channel closed');
                    this.disableChat();
                };
                
                this.dataChannel = channel;
            }
            
            async acceptOffer() {
                const offerText = document.getElementById('remoteOffer').value.trim();
                if (!offerText) {
                    alert('Please paste an offer first!');
                    return;
                }
                
                try {
                    const offer = JSON.parse(offerText);
                    
                    if (!this.localStream) {
                        await this.startCamera();
                    }
                    
                    await this.createPeerConnection();
                    await this.peerConnection.setRemoteDescription(offer);
                    
                    const answer = await this.peerConnection.createAnswer();
                    await this.peerConnection.setLocalDescription(answer);
                    
                    document.getElementById('localAnswer').value = JSON.stringify(answer);
                    this.statusMessage.textContent = 'Answer created! Share it with your partner.';
                    this.showWaiting();
                    
                } catch (error) {
                    console.error('Error accepting offer:', error);
                    alert('Invalid offer format!');
                }
            }
            
            async acceptAnswer() {
                const answerText = document.getElementById('remoteAnswer').value.trim();
                if (!answerText) {
                    alert('Please paste an answer first!');
                    return;
                }
                
                try {
                    const answer = JSON.parse(answerText);
                    await this.peerConnection.setRemoteDescription(answer);
                    this.statusMessage.textContent = 'Connecting...';
                    this.showWaiting();
                    
                } catch (error) {
                    console.error('Error accepting answer:', error);
                    alert('Invalid answer format!');
                }
            }
            
            endChat() {
                if (this.localStream) {
                    this.localStream.getTracks().forEach(track => track.stop());
                    this.localStream = null;
                }
                
                if (this.peerConnection) {
                    this.peerConnection.close();
                    this.peerConnection = null;
                }
                
                this.localVideo.srcObject = null;
                this.remoteVideo.srcObject = null;
                
                this.startBtn.disabled = false;
                this.createOfferBtn.disabled = true;
                this.endBtn.disabled = true;
                
                this.isConnected = false;
                this.disableChat();
                this.clearChat();
                this.clearConnectionInputs();
                
                this.statusMessage.textContent = 'Click "Start Camera" to begin';
                this.hideWaiting();
            }
            
            handleDisconnection() {
                this.remoteVideo.srcObject = null;
                this.isConnected = false;
                this.disableChat();
                this.statusMessage.textContent = 'Partner disconnected.';
            }
            
            showWaiting() {
                this.waitingMessage.style.display = 'block';
            }
            
            hideWaiting() {
                this.waitingMessage.style.display = 'none';
            }
            
            sendMessage() {
                const message = this.chatInput.value.trim();
                if (message && this.dataChannel && this.dataChannel.readyState === 'open') {
                    this.dataChannel.send(message);
                    this.displayMessage(message, true);
                    this.chatInput.value = '';
                }
            }
            
            displayMessage(message, isOwn) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isOwn ? 'own' : 'other'}`;
                messageDiv.textContent = `${isOwn ? 'You' : 'Partner'}: ${message}`;
                
                this.chatMessages.appendChild(messageDiv);
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }
            
            enableChat() {
                this.chatInput.disabled = false;
                this.sendBtn.disabled = false;
                this.chatInput.placeholder = 'Type a message...';
            }
            
            disableChat() {
                this.chatInput.disabled = true;
                this.sendBtn.disabled = true;
                this.chatInput.placeholder = 'Connect to start chatting...';
                this.chatInput.value = '';
            }
            
            clearChat() {
                this.chatMessages.innerHTML = '<div style="text-align: center; color: #7f8c8d; font-style: italic;">Connect to start chatting!</div>';
            }
            
            clearConnectionInputs() {
                document.getElementById('localOffer').value = '';
                document.getElementById('remoteOffer').value = '';
                document.getElementById('localAnswer').value = '';
                document.getElementById('remoteAnswer').value = '';
            }
        }
        
        // Global functions for buttons
        let videoChat;
        
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            element.setSelectionRange(0, 99999);
            document.execCommand('copy');
            
            const button = element.nextElementSibling;
            const originalText = button.textContent;
            button.textContent = 'Copied!';
            setTimeout(() => {
                button.textContent = originalText;
            }, 2000);
        }
        
        function acceptOffer() {
            videoChat.acceptOffer();
        }
        
        function acceptAnswer() {
            videoChat.acceptAnswer();
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            videoChat = new GitHubPagesVideoChat();
        });
    </script>
</body>
</html>